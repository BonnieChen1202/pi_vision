<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ ‘è“æ´¾å›¾åƒè¯†åˆ«å¹³å°</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Archivo:wght@400;600;700&family=Source+Code+Pro:wght@400;600&display=swap');

        :root {
            --bg: #0e1116;
            --bg-soft: #141925;
            --panel: #151b28;
            --panel-2: #1a2233;
            --text: #e9edf4;
            --muted: #a6b0c3;
            --primary: #52e0c4;
            --primary-2: #4fb0ff;
            --danger: #ff5f6d;
            --shadow: 0 20px 45px rgba(6, 10, 20, 0.4);
            --ring: 0 0 0 3px rgba(82, 224, 196, 0.25);
        }

        body.light {
            --bg: #f4f7fb;
            --bg-soft: #eef2f8;
            --panel: #ffffff;
            --panel-2: #f7f9fc;
            --text: #111827;
            --muted: #5f6b7a;
            --primary: #2db4a5;
            --primary-2: #2f79ff;
            --danger: #e0444f;
            --shadow: 0 20px 45px rgba(15, 23, 42, 0.12);
            --ring: 0 0 0 3px rgba(45, 180, 165, 0.2);
        }

        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: 'Archivo', system-ui, -apple-system, sans-serif;
            color: var(--text);
            background:
                radial-gradient(900px 380px at 15% -10%, rgba(82, 224, 196, 0.18), transparent 60%),
                radial-gradient(700px 360px at 90% 5%, rgba(79, 176, 255, 0.2), transparent 55%),
                linear-gradient(120deg, var(--bg) 0%, var(--bg-soft) 100%);
            min-height: 100vh;
        }

        body.light {
            background:
                radial-gradient(900px 380px at 15% -10%, rgba(45, 180, 165, 0.2), transparent 60%),
                radial-gradient(700px 360px at 90% 5%, rgba(47, 121, 255, 0.18), transparent 55%),
                linear-gradient(120deg, var(--bg) 0%, var(--bg-soft) 100%);
        }

        .page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 36px 20px 60px;
        }

        .header {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 18px;
            justify-content: space-between;
            margin-bottom: 28px;
        }

        .title {
            text-align: left;
        }

        .title h1 {
            font-size: clamp(28px, 3vw, 38px);
            margin: 0 0 8px 0;
            letter-spacing: 0.3px;
        }

        .title p {
            margin: 0;
            color: var(--muted);
            font-size: 15px;
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            border-radius: 999px;
            background: rgba(82, 224, 196, 0.12);
            color: var(--primary);
            border: 1px solid rgba(82, 224, 196, 0.3);
            font-weight: 600;
            font-size: 14px;
            backdrop-filter: blur(6px);
        }

        body.light .status-pill {
            background: rgba(45, 180, 165, 0.16);
            border-color: rgba(45, 180, 165, 0.35);
            color: var(--primary);
        }

        .toolbar {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-btn {
            padding: 9px 14px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.14);
            background: rgba(255, 255, 255, 0.08);
            color: var(--text);
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .tool-btn:hover { transform: translateY(-1px); }
        .tool-btn:focus-visible { outline: none; box-shadow: var(--ring); }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary);
            box-shadow: 0 0 8px rgba(82, 224, 196, 0.8);
            animation: pulse 1.6s ease-in-out infinite;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .panel {
            background: linear-gradient(160deg, var(--panel) 0%, var(--panel-2) 100%);
            border-radius: 18px;
            padding: 22px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            transform: translateY(8px);
            opacity: 0;
            animation: rise 0.7s ease forwards;
        }

        .panel:nth-child(2) { animation-delay: 0.12s; }
        .panel:nth-child(3) { animation-delay: 0.24s; }

        .pi-corner-panel {
            position: fixed;
            right: 12px;
            bottom: 12px;
            width: min(220px, calc(100vw - 16px));
            z-index: 40;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            padding: 10px;
        }

        .panel h3 {
            margin: 0 0 14px 0;
            font-size: 18px;
        }

        .pi-corner-panel h3 {
            margin-bottom: 6px;
            font-size: 13px;
        }

        .panel .sub {
            color: var(--muted);
            font-size: 13px;
            margin-bottom: 14px;
        }

        .pi-corner-panel .sub {
            font-size: 10px;
            margin-bottom: 8px;
        }

        .pi-status-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 6px;
        }

        .metric-card {
            padding: 6px;
            border-radius: 8px;
            background: rgba(11, 15, 22, 0.65);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        body.light .metric-card {
            background: rgba(245, 248, 252, 0.9);
            border-color: rgba(15, 23, 42, 0.12);
        }

        .metric-head {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            gap: 4px;
            margin-bottom: 6px;
        }

        .metric-name {
            font-size: 9px;
            color: var(--muted);
            letter-spacing: 0.1px;
        }

        .metric-value {
            font-size: 12px;
            font-weight: 700;
            font-family: 'Source Code Pro', ui-monospace, SFMono-Regular, Menlo, monospace;
        }

        .metric-value.warn {
            color: #ffcf5a;
        }

        .metric-value.hot {
            color: var(--danger);
        }

        .metric-bar {
            height: 5px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.08);
            overflow: hidden;
            position: relative;
        }

        body.light .metric-bar {
            background: rgba(15, 23, 42, 0.08);
        }

        .metric-fill {
            height: 100%;
            width: 0%;
            border-radius: 999px;
            background: linear-gradient(90deg, var(--primary), var(--primary-2));
            transition: width 0.4s ease, background 0.4s ease;
        }

        .metric-fill.warn {
            background: linear-gradient(90deg, #f7b500, #ffd36e);
        }

        .metric-fill.hot {
            background: linear-gradient(90deg, #ff5f6d, #ff8a6f);
        }

        .status-meta {
            margin-top: 6px;
            font-size: 9px;
            color: var(--muted);
            font-family: 'Source Code Pro', ui-monospace, SFMono-Regular, Menlo, monospace;
            display: flex;
            justify-content: space-between;
            gap: 6px;
            flex-wrap: wrap;
        }

        .media {
            background: #0b0f16;
            border-radius: 14px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.06);
        }

        body.light .media {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(15, 23, 42, 0.12);
        }

        img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            display: block;
        }

        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 16px;
        }

        .status-banner {
            margin-top: 12px;
            padding: 10px 14px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(82, 224, 196, 0.1);
            color: var(--primary);
            font-weight: 600;
            font-size: 14px;
        }

        .status-banner.busy {
            background: rgba(79, 176, 255, 0.12);
            color: var(--primary-2);
        }

        .status-banner.error {
            background: rgba(255, 95, 109, 0.15);
            color: var(--danger);
        }

        body.light .status-banner {
            border-color: rgba(15, 23, 42, 0.1);
        }

        .compare-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
        }

        .compare-card {
            background: rgba(11, 15, 22, 0.65);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 10px;
        }

        body.light .compare-card {
            background: rgba(245, 248, 252, 0.9);
        }

        .compare-card h4 {
            margin: 0 0 8px 0;
            font-size: 13px;
            color: var(--muted);
            font-weight: 600;
        }

        .log-panel {
            margin-top: 18px;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(15, 20, 30, 0.6);
            max-height: 220px;
            overflow-y: auto;
            font-family: 'Source Code Pro', ui-monospace, SFMono-Regular, Menlo, monospace;
            font-size: 12px;
            color: var(--muted);
        }

        body.light .log-panel {
            background: rgba(248, 250, 253, 0.95);
            border-color: rgba(15, 23, 42, 0.12);
        }

        .log-line {
            padding: 6px 2px;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.08);
        }

        body.light .log-line {
            border-bottom-color: rgba(15, 23, 42, 0.08);
        }

        .log-line:last-child { border-bottom: none; }

        button {
            padding: 10px 18px;
            font-size: 15px;
            cursor: pointer;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            color: #0b0f15;
            background: linear-gradient(120deg, var(--primary), #9fffe1);
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 24px rgba(82, 224, 196, 0.25);
        }

        button:focus-visible {
            outline: none;
            box-shadow: var(--ring);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(120deg, #3b4a67, #7f8fb1);
            color: #f7f9ff;
        }

        .btn-danger {
            background: linear-gradient(120deg, var(--danger), #ff9f8b);
            color: #1a0b0b;
        }

        body.light button {
            color: #0b0f15;
            background: linear-gradient(120deg, #33c0b1, #a7f0e7);
        }

        body.light button:hover {
            box-shadow: 0 10px 24px rgba(45, 180, 165, 0.25);
        }

        body.light .btn-secondary {
            background: linear-gradient(120deg, #5a6d8f, #aab8cf);
            color: #101827;
        }

        body.light .btn-danger {
            background: linear-gradient(120deg, #e6525e, #ffb9a8);
            color: #2a0d10;
        }

        .preview-placeholder {
            font-family: 'Source Code Pro', ui-monospace, SFMono-Regular, Menlo, monospace;
            color: var(--muted);
            font-size: 13px;
            padding: 22px;
            text-align: center;
            border-radius: 12px;
            border: 1px dashed rgba(255, 255, 255, 0.15);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.6; }
        }

        @keyframes rise {
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 720px) {
            .header { gap: 12px; }
            .status-pill { width: 100%; justify-content: center; }
        }

        @media (max-width: 980px) {
            .pi-corner-panel {
                position: static;
                width: auto;
                right: auto;
                bottom: auto;
            }
        }
    </style>
</head>
<body>

    <div class="page">
        <div class="header">
            <div class="title">
                <h1>æ ‘è“æ´¾å®æ—¶ç›‘æµ‹ä¸ç›®æ ‡æ£€æµ‹</h1>
                <p>è¾¹ç¼˜ç«¯å®æ—¶è§†è§‰ç›‘æ§ Â· ä¸€é”®æŠ“æ‹ Â· å•å¼ è¯†åˆ«</p>
            </div>
            <div class="toolbar">
                <button id="themeToggle" class="tool-btn" onclick="toggleTheme()">ğŸŒ— åˆ‡æ¢ä¸»é¢˜</button>
                <div class="status-pill">
                    <span class="status-dot"></span>
                    <span>ç³»ç»Ÿåœ¨çº¿</span>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="panel">
                <h3>å®æ—¶ç›‘æ§</h3>
                <div class="sub">å®æ—¶è§†é¢‘æµ + ç›®æ ‡è¯†åˆ«è”åŠ¨</div>
                <div class="media">
                    <img id="videoStream" src="/video_feed" alt="å®æ—¶è§†é¢‘æµ">
                </div>
                <div class="actions">
                    <button id="realtimeBtn" onclick="toggleRealtime()">ğŸ‘ï¸ å¼€å¯å®æ—¶è¯†åˆ«</button>
                    <button id="captureBtn" class="btn-secondary" onclick="takePhoto()">ğŸ“· æ‹ç…§è®°å½•</button>
                </div>
                <div id="statusBanner" class="status-banner">å‡†å¤‡å°±ç»ª</div>
            </div>

            <div class="panel">
                <h3>å¤„ç†ä¸ç»“æœ</h3>
                <div class="sub">æŠ“æ‹é¢„è§ˆ Â· è¯†åˆ«è¾“å‡º</div>
                <div id="previewArea" class="media">
                    <div class="compare-grid">
                        <div class="compare-card">
                            <h4>åŸå§‹æŠ“æ‹</h4>
                            <div id="captureSlot" class="preview-placeholder">æš‚æ— åŸå§‹å›¾åƒ</div>
                        </div>
                        <div class="compare-card">
                            <h4>è¯†åˆ«ç»“æœ</h4>
                            <div id="resultSlot" class="preview-placeholder">æš‚æ— è¯†åˆ«ç»“æœ</div>
                        </div>
                    </div>
                </div>
                <div class="actions">
                    <button id="recognizeBtn" onclick="runRecognition()" disabled>ğŸ” å¼€å§‹å•å¼ è¯†åˆ«</button>
                </div>
                <div id="logPanel" class="log-panel"></div>
            </div>

            <div class="panel pi-corner-panel">
                <h3>æ ‘è“æ´¾çŠ¶æ€</h3>
                <div class="sub">CPU / å†…å­˜ / æ¸©åº¦ / ç£ç›˜å®æ—¶å¥åº·ç›‘æ§</div>
                <div class="pi-status-grid">
                    <div class="metric-card">
                        <div class="metric-head">
                            <span class="metric-name">CPU ä½¿ç”¨ç‡</span>
                            <span id="cpuValue" class="metric-value">--%</span>
                        </div>
                        <div class="metric-bar"><div id="cpuFill" class="metric-fill"></div></div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-head">
                            <span class="metric-name">å†…å­˜ä½¿ç”¨ç‡</span>
                            <span id="memValue" class="metric-value">--%</span>
                        </div>
                        <div class="metric-bar"><div id="memFill" class="metric-fill"></div></div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-head">
                            <span class="metric-name">CPU æ¸©åº¦</span>
                            <span id="tempValue" class="metric-value">--Â°C</span>
                        </div>
                        <div class="metric-bar"><div id="tempFill" class="metric-fill"></div></div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-head">
                            <span class="metric-name">ç£ç›˜ä½¿ç”¨ç‡</span>
                            <span id="diskValue" class="metric-value">--%</span>
                        </div>
                        <div class="metric-bar"><div id="diskFill" class="metric-fill"></div></div>
                    </div>
                </div>
                <div class="status-meta">
                    <span id="uptimeText">è¿è¡Œæ—¶é•¿: --</span>
                    <span id="syncText">åŒæ­¥ä¸­...</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentFilename = "";
        let isRealtime = false;

        function setStatus(text, type = "") {
            const banner = document.getElementById('statusBanner');
            banner.classList.remove('busy', 'error');
            if (type) banner.classList.add(type);
            banner.innerText = text;
        }

        function addLog(message) {
            const logPanel = document.getElementById('logPanel');
            const line = document.createElement('div');
            line.className = 'log-line';
            const time = new Date().toLocaleTimeString();
            line.innerText = `[${time}] ${message}`;
            logPanel.prepend(line);
        }

        function updateSlots(captureUrl, resultUrl) {
            const captureSlot = document.getElementById('captureSlot');
            const resultSlot = document.getElementById('resultSlot');
            if (captureUrl) {
                captureSlot.innerHTML = `<img src="${captureUrl}?t=${new Date().getTime()}" alt="æŠ“æ‹å›¾ç‰‡">`;
            }
            if (resultUrl) {
                resultSlot.innerHTML = `<img src="${resultUrl}?t=${new Date().getTime()}" alt="è¯†åˆ«ç»“æœ">`;
            }
        }

        function setMetric(idPrefix, value, max, unit, warnAt, hotAt) {
            const safeValue = Number.isFinite(value) ? value : 0;
            const percent = Math.max(0, Math.min(100, (safeValue / max) * 100));
            const valueEl = document.getElementById(`${idPrefix}Value`);
            const fillEl = document.getElementById(`${idPrefix}Fill`);
            valueEl.classList.remove('warn', 'hot');
            fillEl.classList.remove('warn', 'hot');
            if (safeValue >= hotAt) {
                valueEl.classList.add('hot');
                fillEl.classList.add('hot');
            } else if (safeValue >= warnAt) {
                valueEl.classList.add('warn');
                fillEl.classList.add('warn');
            }
            valueEl.innerText = `${safeValue.toFixed(1)}${unit}`;
            fillEl.style.width = `${percent.toFixed(1)}%`;
        }

        function formatUptime(seconds) {
            const s = Math.max(0, Math.floor(seconds || 0));
            const h = Math.floor(s / 3600);
            const m = Math.floor((s % 3600) / 60);
            const sec = s % 60;
            return `${h}h ${m}m ${sec}s`;
        }

        let statusPollTimer = null;
        const scriptRoot = {{ request.script_root|tojson }};

        async function fetchSystemStatus() {
            const withRoot = (path) => `${scriptRoot}${path}`;
            const endpoints = [
                withRoot('/system_status'),
                withRoot('/system_status/'),
                withRoot('/status'),
                withRoot('/api/system_status')
            ];
            let lastStatus = null;
            for (const endpoint of endpoints) {
                const response = await fetch(endpoint);
                lastStatus = response.status;
                if (response.ok) {
                    return response.json();
                }
            }
            throw new Error(`HTTP_${lastStatus || 'UNKNOWN'}`);
        }

        function refreshPiStatus() {
            fetchSystemStatus()
                .then(data => {
                    if (data.status !== 'success') return;
                    setMetric('cpu', data.cpu_usage, 100, '%', 70, 90);
                    setMetric('mem', data.memory_usage, 100, '%', 70, 90);
                    setMetric('disk', data.disk_usage, 100, '%', 75, 90);
                    if (data.cpu_temp === null) {
                        document.getElementById('tempValue').innerText = 'N/A';
                        document.getElementById('tempFill').style.width = '0%';
                    } else {
                        setMetric('temp', data.cpu_temp, 100, 'Â°C', 60, 75);
                    }
                    document.getElementById('uptimeText').innerText = `è¿è¡Œæ—¶é•¿: ${formatUptime(data.uptime_seconds)}`;
                    document.getElementById('syncText').innerText = `æœ€åæ›´æ–°: ${new Date().toLocaleTimeString()}`;
                })
                .catch((err) => {
                    if ((err.message || '').includes('HTTP_404')) {
                        document.getElementById('syncText').innerText = 'çŠ¶æ€æ¥å£ä¸å­˜åœ¨(404)';
                        if (statusPollTimer) {
                            clearInterval(statusPollTimer);
                            statusPollTimer = null;
                        }
                    } else {
                        document.getElementById('syncText').innerText = 'çŠ¶æ€åŒæ­¥å¤±è´¥';
                    }
                });
        }

        function applyTheme(theme) {
            document.body.classList.toggle('light', theme === 'light');
            localStorage.setItem('pi_theme', theme);
        }

        function toggleTheme() {
            const isLight = document.body.classList.contains('light');
            applyTheme(isLight ? 'dark' : 'light');
        }

        const savedTheme = localStorage.getItem('pi_theme') || 'dark';
        applyTheme(savedTheme);
        refreshPiStatus();
        statusPollTimer = setInterval(refreshPiStatus, 2000);

        // åˆ‡æ¢å®æ—¶è¯†åˆ«çŠ¶æ€
        function toggleRealtime() {
            isRealtime = !isRealtime;
            const btn = document.getElementById('realtimeBtn');
            
            // æŒ‰é’®çŠ¶æ€è¿‡æ¸¡åé¦ˆ
            btn.innerText = "åˆ‡æ¢ä¸­...";
            btn.disabled = true;
            setStatus('å®æ—¶è¯†åˆ«åˆ‡æ¢ä¸­...', 'busy');
            addLog('è¯·æ±‚åˆ‡æ¢å®æ—¶è¯†åˆ«');

            fetch('/toggle_realtime', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled: isRealtime })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    if (data.realtime_enabled) {
                        btn.innerText = "ğŸ›‘ å…³é—­å®æ—¶è¯†åˆ«";
                        btn.classList.add("btn-danger");
                        setStatus('å®æ—¶è¯†åˆ«å·²å¼€å¯');
                        addLog('å®æ—¶è¯†åˆ«å·²å¼€å¯');
                    } else {
                        btn.innerText = "ğŸ‘ï¸ å¼€å¯å®æ—¶è¯†åˆ«";
                        btn.classList.remove("btn-danger");
                        setStatus('å®æ—¶è¯†åˆ«å·²å…³é—­');
                        addLog('å®æ—¶è¯†åˆ«å·²å…³é—­');
                    }
                } else {
                    setStatus('å®æ—¶è¯†åˆ«åˆ‡æ¢å¤±è´¥', 'error');
                    addLog(`å®æ—¶è¯†åˆ«åˆ‡æ¢å¤±è´¥: ${data.message || 'æœªçŸ¥é”™è¯¯'}`);
                }
            })
            .catch(err => console.error('Error:', err))
            .finally(() => {
                btn.disabled = false;
            });
        }

        // æ‹ç…§å¹¶æ˜¾ç¤ºé¢„è§ˆ
        function takePhoto() {
            setStatus('æ­£åœ¨æŠ“æ‹...', 'busy');
            addLog('å‘é€æŠ“æ‹è¯·æ±‚');
            fetch('/capture', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        currentFilename = data.filename;
                        updateSlots(data.image_url, null);
                        document.getElementById('recognizeBtn').disabled = false;
                        setStatus('æŠ“æ‹å®Œæˆï¼Œç­‰å¾…è¯†åˆ«');
                        addLog('æŠ“æ‹æˆåŠŸ');
                    } else {
                        alert("æ‹ç…§å¤±è´¥ï¼š" + data.message);
                        setStatus('æŠ“æ‹å¤±è´¥', 'error');
                        addLog(`æŠ“æ‹å¤±è´¥: ${data.message}`);
                    }
                })
                .catch(err => console.error('Error:', err));
        }

        // è°ƒç”¨å•å¼ è¯†åˆ«æ¥å£
        function runRecognition() {
            if (!currentFilename) return;
            
            const btn = document.getElementById('recognizeBtn');
            btn.innerText = "â³ è¯†åˆ«ä¸­...";
            btn.disabled = true;
            setStatus('è¯†åˆ«å¤„ç†ä¸­...', 'busy');
            addLog('å¼€å§‹å•å¼ è¯†åˆ«');

            fetch('/recognize', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ filename: currentFilename })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    updateSlots(null, data.result_url);
                    setStatus('è¯†åˆ«å®Œæˆ');
                    addLog('è¯†åˆ«å®Œæˆ');
                } else {
                    alert("è¯†åˆ«å¤±è´¥ï¼š" + data.message);
                    setStatus('è¯†åˆ«å¤±è´¥', 'error');
                    addLog(`è¯†åˆ«å¤±è´¥: ${data.message}`);
                }
            })
            .catch(err => console.error('Error:', err))
            .finally(() => {
                btn.innerText = "ğŸ” å¼€å§‹å•å¼ è¯†åˆ«";
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>
