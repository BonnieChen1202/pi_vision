<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ ‘è“æ´¾å›¾åƒè¯†åˆ«å¹³å°</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #f4f4f9; padding: 20px; }
        .container { display: flex; justify-content: space-around; flex-wrap: wrap; max-width: 1200px; margin: 0 auto; }
        .panel { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin: 10px; width: 45%; }
        img { max-width: 100%; height: auto; border-radius: 4px; border: 1px solid #ddd; }
        button { padding: 10px 20px; font-size: 16px; margin: 15px 5px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 4px; transition: 0.3s; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>

    <h1>æ ‘è“æ´¾å®æ—¶ç›‘æµ‹ä¸ç›®æ ‡æ£€æµ‹</h1>
    
    <div class="container">
        <div class="panel">
            <h3>å®æ—¶ç›‘æ§</h3>
            <img src="/video_feed" alt="å®æ—¶è§†é¢‘æµ">
            <br>
            <button id="captureBtn" onclick="takePhoto()">ğŸ“· æ‹ç…§è®°å½•</button>
        </div>

        <div class="panel">
            <h3>å¤„ç†ä¸ç»“æœ</h3>
            <div id="previewArea">
                <p style="color: #666;">æš‚æ— ç…§ç‰‡ï¼Œè¯·å…ˆæ‹ç…§ã€‚</p>
            </div>
            <button id="recognizeBtn" onclick="runRecognition()" disabled>ğŸ” å¼€å§‹è¯†åˆ«</button>
        </div>
    </div>

    <script>
        let currentFilename = "";

        // æ‹ç…§å¹¶æ˜¾ç¤ºé¢„è§ˆ
        function takePhoto() {
            fetch('/capture', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        currentFilename = data.filename;
                        const previewArea = document.getElementById('previewArea');
                        previewArea.innerHTML = `<h4>æŠ“æ‹é¢„è§ˆï¼š</h4><img src="${data.image_url}?t=${new Date().getTime()}" alt="æŠ“æ‹å›¾ç‰‡">`;
                        document.getElementById('recognizeBtn').disabled = false;
                    } else {
                        alert("æ‹ç…§å¤±è´¥ï¼š" + data.message);
                    }
                })
                .catch(err => console.error('Error:', err));
        }

        // è°ƒç”¨è¯†åˆ«æ¥å£
        function runRecognition() {
            if (!currentFilename) return;
            
            const btn = document.getElementById('recognizeBtn');
            btn.innerText = "â³ è¯†åˆ«ä¸­...";
            btn.disabled = true;

            fetch('/recognize', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ filename: currentFilename })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    const previewArea = document.getElementById('previewArea');
                    previewArea.innerHTML = `<h4>è¯†åˆ«ç»“æœï¼š</h4><img src="${data.result_url}?t=${new Date().getTime()}" alt="è¯†åˆ«ç»“æœ">`;
                } else {
                    alert("è¯†åˆ«å¤±è´¥ï¼š" + data.message);
                }
            })
            .catch(err => console.error('Error:', err))
            .finally(() => {
                btn.innerText = "ğŸ” å¼€å§‹è¯†åˆ«";
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>